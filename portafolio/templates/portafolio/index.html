{% extends "portafolio/base.html" %}
{% load static %}

{% block head_title %}
Irene Hurtado ‚Äì Portafolio
{% endblock %}

{% block head %}
<!-- Estilos o scripts adicionales -->
{% endblock %}

{% block page_content %}

<!-- Header con degradado y botones -->
<header class="bg-gradient-purple py-5 text-white">
  <div class="container px-5">
    <div class="row gx-5 align-items-center justify-content-center">
      <div class="col-lg-6 col-xl-5 text-center text-lg-start">
        <h1 class="display-5 fw-bold mb-2">HolaMundo! soy Irene Hurtado</h1>
        <p class="lead fw-normal text-white-50 mb-4">Desarrolladora Fullstack | Apasionada por la tecnolog√≠a y el aprendizaje continuo</p>
        <div class="d-grid gap-3 d-sm-flex justify-content-sm-center justify-content-lg-start">
          <a class="btn btn-light btn-lg px-4 me-sm-3" href="{% url 'projects' %}">Ver m√°s</a>
          <a class="btn btn-outline-light btn-lg px-4" href="https://youtu.be/Xm4jwpfIADM?si=IPbRWZK8YBGHOHOQ" target="_blank" rel="noopener noreferrer">Get to know me</a>
        </div>
      <!-- IA Prompt Formulario -->
       <form id="ia-form" method="post" class="d-flex gap-2 mt-4">
        {% csrf_token %}
        <div class="input-group">
          <input type="text" name="pregunta" id="pregunta" class="form-control" placeholder="Preg√∫ntame algo sobre tech o IA ..." required>
          <button type="submit" class="btn btn-light text-purple1 fw-bold">Enviar</button>
        </div>
      </form>
      <p id="contador-preguntas" class="mt-2 text-white">
        Te quedan <span id="restantes">3</span> preguntas por hoy.
      </p>
      <div id="respuesta-ia" class="mt-3 text-white-50"></div> 
      </div>
      <div class="col-xl-5 col-xxl-6 text-center">
        <img class="img-fluid rounded-3 my-5" src="{% static 'images/irene.png' %}" alt="Foto" />
      </div>
    </div>
  </div>
</header>

<!-- Skills agrupadas -->
<section class="py-5" id="habilidades">
  <div class="container px-5 my-5">
    <h2 class="fw-bolder text-purple1 mb-4">Skills</h2>
    <div class="row">
      <div class="col-md-4 mb-4 fade-in">
        <h4 class="text-purple1">Frontend</h4>
        <div class="d-grid gap-2">
          <a href="{% url 'certificados_categoria' 'frontend' %}" class="text-decoration-none">
            <div class="bg-purple1 text-white p-2 rounded text-center skill-box">HTML</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frontend' %}" class="text-decoration-none">
            <div class="bg-purple2 text-white p-2 rounded text-center skill-box">CSS</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frontend' %}" class="text-decoration-none">
            <div class="bg-purple3 text-white p-2 rounded text-center skill-box">JavaScript</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frontend' %}" class="text-decoration-none">
            <div class="bg-purple4 text-white p-2 rounded text-center skill-box">TypeScript</div>
          </a>
        </div>
      </div>
      <div class="col-md-4 mb-4 fade-in">
        <h4 class="text-purple1">Backend</h4>
        <div class="d-grid gap-2">
          <a href="{% url 'certificados_categoria' 'backend' %}" class="text-decoration-none">
            <div class="bg-purple2 text-white p-2 rounded text-center skill-box">Python</div>
          </a>
          <a href="{% url 'certificados_categoria' 'backend' %}" class="text-decoration-none">
            <div class="bg-purple3 text-white p-2 rounded text-center skill-box">Java</div>
          </a>
          <a href="{% url 'certificados_categoria' 'backend' %}" class="text-decoration-none">
            <div class="bg-purple1 text-white p-2 rounded text-center skill-box">Node.js</div>
          </a>
          <a href="{% url 'certificados_categoria' 'backend' %}" class="text-decoration-none">
            <div class="bg-purple4 text-white p-2 rounded text-center skill-box">Rust</div>
          </a>
          <a href="{% url 'certificados_categoria' 'backend' %}" class="text-decoration-none">
            <div class="bg-purple2 text-white p-2 rounded text-center skill-box">SQL</div>
          </a>
        </div>
      </div>
      <div class="col-md-4 mb-4 fade-in">
        <h4 class="text-purple1">Frameworks e Idiomas</h4>
        <div class="d-grid gap-2">
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple3 text-white p-2 rounded text-center skill-box">React</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple4 text-white p-2 rounded text-center skill-box">Django</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple1 text-white p-2 rounded text-center skill-box">Spring Boot</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple2 text-white p-2 rounded text-center skill-box">Angular</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple3 text-white p-2 rounded text-center skill-box">Vue</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple4 text-white p-2 rounded text-center skill-box">Git</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple2 text-white p-2 rounded text-center skill-box">GitHub</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple1 text-white p-2 rounded text-center skill-box">Espa√±ol nativo</div>
          </a>
          <a href="{% url 'certificados_categoria' 'frameworks' %}" class="text-decoration-none">
            <div class="bg-purple3 text-white p-2 rounded text-center skill-box">Ingl√©s C1</div>
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("ia-form");
    const preguntaInput = document.getElementById("pregunta");
    const respuestaDiv = document.getElementById("respuesta-ia");
    const restantesSpan = document.getElementById("restantes");

    // Fecha actual
    const hoy = new Date().toISOString().split('T')[0];
    const ultimaFecha = localStorage.getItem("fechaUltimoUso");

    // Reinicio contador
    if (ultimaFecha !== hoy) {
      localStorage.setItem("restantesPreguntasIA", 3);
      localStorage.setItem("fechaUltimoUso", hoy);
    }

    // Preguntas restantes
    const restantesGuardados = localStorage.getItem("restantesPreguntasIA");
    if (restantesGuardados !== null && restantesSpan) {
      restantesSpan.textContent = restantesGuardados;

      if (parseInt(restantesGuardados) === 0) {
        const enviarBtn = form.querySelector("button[type=submit]");
        enviarBtn.disabled = true;
        enviarBtn.textContent = "L√≠mite alcanzado üòÖ";
      }
    }

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const pregunta = preguntaInput.value.trim();
      if (!pregunta) return;

      respuestaDiv.innerHTML = "Pensando... ü§ñ";

      fetch("{% url 'index' %}", {
        method: "POST",
        headers: {
          "X-Requested-With": "XMLHttpRequest",
          "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: "pregunta=" + encodeURIComponent(pregunta),
      })
        .then((response) => response.json())
        .then((data) => {
          respuestaDiv.innerHTML = data.respuesta;

          if (data.restantes !== undefined && restantesSpan) {
            restantesSpan.textContent = data.restantes;

            localStorage.setItem("restantesPreguntasIA", data.restantes);
            localStorage.setItem("fechaUltimoUso", hoy);

            if (data.restantes === 0) {
              const enviarBtn = form.querySelector("button[type=submit]");
              enviarBtn.disabled = true;
              enviarBtn.textContent = "L√≠mite alcanzado üòÖ";
            }
          }
        })
        .catch((error) => {
          respuestaDiv.innerHTML = "Ocurri√≥ un error: " + error;
        });
    });
  });
</script>
{% endblock %}
